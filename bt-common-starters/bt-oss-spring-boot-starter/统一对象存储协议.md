## 前言

在日常开发文件上传相关服务时，通常都会选择腾讯云,阿里云,七牛云等提供的oss服务作为文件存储系统,如果需要自行搭建文件存储系统，通常则会采用minio等开源项目。

但是大家有没有考虑过，不同的厂商或者开源项目提供的客户端sdk都是不同的，如果项目开发过程中，需要切换底层文件系统，那么通常情况下意味着，我们需要完全替换掉相关文件上传代码，如果微服务项目，则需要替换掉所有使用到文件上传sdk微服务的代码，这显然会带来巨大的工作量。

基本所有云服务厂商提供的oss服务和开源的oss项目都遵循了S3协议，是Simple Storage Service的缩写，即简单存储服务

因此其实我们这里利用这一点，写出一个通用的文件中间件，利用该中间件后，我们写的客户端api就对任何实现了S3协议的oss服务进行访问。

## what is S3 protocol？

Simple Storage Service (S3), 简单对象存储服务

Amazon S3 是一种对象存储服务，可通过 Web 服务接口存储和检索任意数量的数据，任何时间，任何地点。它提供了高可用性、持久性和可扩展性，适用于大量数据的存储。

要将对象数据存储在 S3，需要创建存储桶（CreateBucket），然后指定存储桶名称（BucketName）和 AWS 区域（Region）。

存储桶是存储对象的容器，类似于文件夹。存储桶名称必须是全局唯一的，因为 S3 使用存储桶名称来**创建存储桶的 DNS 名称**。 

然后将数据作为 S3 中的对象，上传到该存储桶中。每个对象都会带有密钥（Key）或键名称，用于唯一标识该对象。对象数据可以是任何类型的数据，例如文本文件、图像、视频等。

## 存储桶

存储桶是用于存储对象的容器。您可以在存储桶中存储任意数量的对象

每个对象都储存在一个存储桶中。例如，如果名为 photos/puppy.jpg 的对象存储在美国西部（俄勒冈州）区域的 `amzn-s3-demo-bucket` 存储桶中，
则可使用 URL: `https://amzn-s3-demo-bucket.s3.us-west-2.amazonaws.com/photos/puppy.jpg` 对该对象进行寻址。

存储桶名称必须是全局唯一的，因为 S3 使用存储桶名称来创建存储桶的 DNS 名称。存储桶名称必须符合 DNS 命名约定（例如，不得包含大写字母）。

## 对象

对象是存储的基础实体。对象由对象数据和元数据组成。 

元数据是一组描述对象的名称-值对。 这些对值包括一些默认元数据（如上次修改日期）和标准 HTTP 元数据（如 Content-Type）。您还可以在存储对象时指定自定义元数据。

## 键

对象密钥（或密钥名称）是指存储桶中对象的唯一标识符。存储桶内的每个对象都只能有一个键。存储桶、对象密钥和可选版本 ID 的组合（如果为存储桶启用了 S3 版本控制）唯一标识每个对象。

因此，可以将 Amazon S3 看作“**存储桶 + 键 + 版本**” 与 **对象**本身之间的基本数据映射。

将 Web 服务端点、存储桶名称、密钥和版本（可选）组合在一起，可唯一地寻址 Amazon S3 中的每个对象。

例如，在 URL `https://amzn-s3-demo-bucket.s3.us-west-2.amazonaws.com/photos/puppy.jpg` 中，`amzn-s3-demo-bucket` 是存储桶的名称，`photos/puppy.jpg` 是密钥。



## 参考资料

- [What is Amazon S3?](https://www.zhihu.com/question/343713732/answer/1443277985)
- [Amazon S3 官方文档](https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/userguide/Welcome.html)
- [通过S3协议实现通用的文件存储服务中间件](https://blog.csdn.net/m0_53157173/article/details/126808223)
